#-----------------------------------------
# Resolution
record(ai, "$(P){$(Q)-Ax:$(AX)}MRES-SP") {
    info(autosaveFields_pass0, "VAL")
}

#-----------------------------------------
# Position
record(ai, "$(P){$(Q)-Ax:$(AX)}Pos-SP") {
    field(DESC, "$(DESC)")
    field(EGU,  "$(EGU)")
    field(FLNK, "$(P){$(Q)-Ax:$(AX)}Pos-SP-RAW")
    info(autosaveFields_pass0, "DESC")
}

record(calcout, "$(P){$(Q)-Ax:$(AX)}Pos-SP-RAW") {
    field(DTYP, "stream")
    field(INPA, "$(P){$(Q)-Ax:$(AX)}Pos-SP")
    field(INPB, "$(P){$(Q)-Ax:$(AX)}MRES-SP")
    field(CALC, "A/B")
    field(OUT,  "@ez4axis.proto setAxParam($(ADDR), $(AX), A) $(PORT)")
    field(EGU,  "cts")
}

record(ai, "$(P){$(Q)-Ax:$(AX)}Pos-RB-RAW") {
    field(DTYP, "stream")
    field(INP,  "@ez4axis.proto getAx$(AX)Pos( $(ADDR), ?aA) $(PORT)")
#    field(SCAN, "2 second")
    field(SCAN, "I/O Intr")
    field(EGU,  "cts")
    field(FLNK, "$(P){$(Q)-Ax:$(AX)}Pos-RB")
}


record(calc, "$(P){$(Q)-Ax:$(AX)}Pos-RB") {
    field(INPA, "$(P){$(Q)-Ax:$(AX)}Pos-RB-RAW")
    field(INPB, "$(P){$(Q)-Ax:$(AX)}MRES-SP")
    field(CALC, "A*B")
    field(EGU, "$(EGU)")
}

#-----------------------------------------
# Stop

record(ao, "$(P){$(Q)-Ax:$(AX)}Stop") {
    field(DTYP, "stream")
    field(OUT,  "@ez4axis.proto stopAx($(ADDR), $(AX), T) $(PORT)")
}

record(ao, "$(P){$(Q)-Ax:$(AX)}StopAll") {
    field(DTYP, "stream")
    field(OUT,  "@ez4axis.proto stopAll($(ADDR)) $(PORT)")
}

#-----------------------------------------
# Home
record(ai "$(P){$(Q)-Ax:$(AX)}HomeDist-SP") {
#   field(DTYP, "stream")
    field(OUT,  "@ez4axis.proto setAxParam($(ADDR), $(AX), Z) $(PORT)")
}

record(calcout, "$(P){$(Q)-Ax:$(AX)}Home") {
    field(DTYP, "stream")
    field(INPA, "$(P){$(Q)-Ax:$(AX)}HomeDist-SP")
    field(INPB, "$(P){$(Q)-Ax:$(AX)}MRES-SP")
    field(CALC, "A/B")
    field(OUT,  "@ez4axis.proto setAxParam($(ADDR), $(AX), Z) $(PORT)")
    field(EGU,  "cts")
}

#-----------------------------------------
# Tweak
record(ai, "$(P){$(Q)-Ax:$(AX)}TWV-SP") {
    field(EGU, "$(EGU)")
    info(autosaveFields_pass0, "VAL")
}

record(calcout, "$(P){$(Q)-Ax:$(AX)}TWF") {
    field(INPA, "$(P){$(Q)-Ax:$(AX)}Pos-RB")
    field(INPB, "$(P){$(Q)-Ax:$(AX)}TWV-SP")
    field(CALC, "A+B")
    field(OUT,  "$(P){$(Q)-Ax:$(AX)}Pos-SP PP")
}

record(calcout, "$(P){$(Q)-Ax:$(AX)}TWR") {
    field(INPA, "$(P){$(Q)-Ax:$(AX)}Pos-RB")
    field(INPB, "$(P){$(Q)-Ax:$(AX)}TWV-SP")
    field(CALC, "A-B")
    field(OUT,  "$(P){$(Q)-Ax:$(AX)}Pos-SP PP")
}

#-----------------------------------------
# Position save/load

record(dfanout, "$(P){$(Q)-Ax:$(AX)}PosSave-Enable") {
    field(DOL, "$(P){$(Q)-Ax:$(AX)}Pos-RB")
    field(OUTA	, "$(P){$(Q)-Ax:$(AX)}PosSave.VAL PP")
#    field(DOL,  "@ez4axis.proto setAxParam($(ADDR), $(AX), z) $(PORT)")
    field(SCAN, "1 second")
    field(SDIS, "$(P){$(Q)}PosSave-Enable")
    field(DISV, 0)
    field(OMSL, "closed_loop")
}


record(ai, "$(P){$(Q)-Ax:$(AX)}PosSave") {
#    field(INP, "$(P){$(Q)-Ax:$(AX)}Pos-RB")
#    field(CALC, "A")
#    field(SCAN, "1 second")
#    field(DISV, 0)
    info(autosaveFields_pass0, "VAL")
}


record(dfanout, "$(P){$(Q)-Ax:$(AX)}PosLoad") {
    field(DOL, "$(P){$(Q)-Ax:$(AX)}PosSave.VAL PP")
    field(OUTA, "$(P){$(Q)-Ax:$(AX)}PosLoad-Out.VAL PP")
#    field(DOL,  "@ez4axis.proto setAxParam($(ADDR), $(AX), z) $(PORT)")
    field(SCAN, "Passive")
    field(OMSL, "closed_loop")
}

record(ao, "$(P){$(Q)-Ax:$(AX)}PosLoad-Out") {
    field(DTYP, "stream")
    field(OUT,  "@ez4axis.proto setAxParam($(ADDR), $(AX), z) $(PORT)")
}

#-----------------------------------------
# Limit
record(bi, "$(P){$(Q)-Ax:$(AX)}Limit-Enable") {
    field(ZNAM, "Disabled")
    field(ONAM, "Enabled")
    info(autosaveFields_pass0, "VAL")
}

record(ao, "$(P){$(Q)-Ax:$(AX)}Limit") {
   field(DTYP, "stream")
   field(OUT,  "@ez4axis.proto setAxCmd($(ADDR), $(AX), n2) $(PORT)")
   field(DISV, 0)
   field(SDIS, "$(P){$(Q)-Ax:$(AX)}Limit-Enable")
   field(PINI, "YES")
}

record(bo, "$(P){$(Q)-Ax:$(AX)}Limit-Pol") {
   field(DTYP, "stream")
   field(ZNAM, "Normally-closed")
   field(ONAM, "Normally-open")
   field(OUT,  "@ez4axis.proto setAxParam($(ADDR), $(AX), f) $(PORT)")
   field(DISV, 0)
   field(SDIS, "$(P){$(Q)-Ax:$(AX)}Limit-Enable")
   field(PINI, "YES")
}
